<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="review">
	<!-- 한 샵의 전체 리뷰 조회 -->
	<select id="allReview">
		select reviewNum, memberId, shopNum, shopName, reviewScore, reviewComment, reviewDepth, reviewGroup
		from review join shopInfo using shopNum
		where shopNum=#{shopNum}
	</select>
	
	<!-- 샵 전체 평점 -->
	<select id="shopScore">
		select sum(reviewScore)/count(reviewScore) scoreAvg
		from review where shopNum=#{shopNum}
	</select>
	
	<!-- 예약했던 유저만 댓글 등록 가능 -->
	<select id="checkRsvn">
		select count(*) from reservation
		where shopNum=#{shopNum} and memberId=#{memberId} and bookingDate>sysdate
	</select>
	
	<!-- 리뷰 한번만 등록 가능 -->
	<select id="checkReview">
		select count 
	</select>
	
	<!-- 리뷰 추가 -->
	<insert id="addReview">
		insert into (reviewNum, memberId, shopNum, reviewScore, reviewCommemt, reviewDepth, reviewGroup)
		values (#{reviewNum},#{memberId},#{shopNum},#{reviewScore},#{reviewCommemt},#{reviewDepth},#{reviewGroup})
	</insert>
</mapper>
